---
type Props = {
  audioUrl: string;
  slug: string;
};

const {audioUrl, slug}: Props = Astro.props;
---

<style>
  .audio-player {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin: auto auto 2em;
  }

  .audio-player__player {
    width: 100%;
  }
</style>

<script>
  /** global umami */
  const audioPlayer = document.querySelector('.audio-player');
  if (audioPlayer) {
    const audioSlug = audioPlayer.getAttribute('data-slug');
    audioPlayer.addEventListener('play', () => {
      console.log(`audio played: ${audioSlug}`);
      window.umami.track('audio-played', {
        slug: audioSlug,
      })
    });

    audioPlayer.addEventListener('ended', () => {
      console.log(`audio ended: ${audioSlug}`);
      window.umami.track('audio-ended', {
        slug: audioSlug,
      })
    });
  }
</script>

<div class="audio-player">
  <audio controls class="audio-player__player" data-slug={slug}>
    <source src={audioUrl} type="audio/mpeg">
    Votre navigateur ne supporte pas la balise audio.
  </audio>
  <a href={audioUrl} class="btn btn-secondary" download={`${slug}.mp3`}>
    Télécharger
  </a>
</div>
